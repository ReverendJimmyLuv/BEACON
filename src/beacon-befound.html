<!--
-->
<link rel="import" href="../bower_components/polymer/polymer-element.html">
<!--<link rel="import" href="../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">-->
<!--<link rel="import" href="../bower_components/paper-listbox/paper-listbox.html">-->
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<!--<link rel="import" href="../bower_components/paper-item/paper-item.html">-->
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../bower_components/vaadin-combo-box/vaadin-combo-box.html">
<link rel="import" href="../bower_components/vaadin-text-field/vaadin-text-field.html">
<link rel="import" href="../bower_components/vaadin-text-field/vaadin-text-area.html">
<link rel="import" href="../bower_components/vaadin-radio-button/vaadin-radio-group.html">
<link rel="import" href="../bower_components/vaadin-radio-button/vaadin-radio-button.html">
<link rel="import" href="../bower_components/vaadin-date-picker/vaadin-date-picker.html">
<link rel="import" href="../bower_components/vaadin-upload/vaadin-upload.html">
<link rel="import" href="../bower_components/vaadin-progress-bar/vaadin-progress-bar.html">
<link rel="import" href="../bower_components/geo-location/geo-location.html">
<!--<link rel="import" href="shared-styles.html">-->
<link rel="import" href="beacon-icons.html">
<link rel="import" href="../bower_components/polymerfire/polymerfire.html">
<link rel="import" href="../bower_components/polymerfire/firebase-storage-multiupload.html">
<link rel="import" href="../bower_components/polymerfire/firebase-query.html">
<!--<link rel="import" href="../bower_components/paper-input/paper-input.html">-->
<!--<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout.html">-->
<link rel="import" href="../bower_components/paper-dialog/paper-dialog.html">


<dom-module id="beacon-befound">
    <template>
        <style>
            :host {
                display: block;
                background-color: #F29737;
                padding: 10px;
                min-height: 100%;
            }

            .card {
                margin: 24px;
                padding: 16px;
                color: #757575;
                border-radius: 5px;
                background-color: #fff;
                box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12), 0 3px 1px -2px rgba(0, 0, 0, 0.2);
            }

            h1 {
                margin: 16px 0;
                color: #212121;
                font-size: 22px;
            }

            /*paper-button.orange {
                background-color: var(--paper-orange-500);
                color: white;
                --paper-button-raised-keyboard-focus: {
                    background-color: var(--paper-pink-a200) !important;
                    color: white !important;
                };
            }*/

            .hide {
                display: none;
            }
        </style>
        <custom-style>
            <style is="custom-style">
                paper-button.beeqin {
                    position: absolute;
                    bottom: 0;
                    right: 0;
                    background-color: #000000;
                    color: #F8C945;
                }

                paper-button.beeqin[active] {
                    background-color: #F29737;
                    color: #000000;
                }
            </style>
        </custom-style>

        <firebase-auth user="{{user}}"></firebase-auth>

        <paper-dialog opened$="[[!user]]"
                      style="background-color: #F8C945"
                      no-cancel-on-esc-key="true"
                      no-cancel-on-outside-click="true">
            <h2>You must login to</h2>
            <h2>create Beeqin</h2>
        </paper-dialog>

        <firebase-query
                id="befound"
                path="/beFoundBeacons"
                data="{{beFoundBeacons}}">
        </firebase-query>
        <firebase-storage-multiupload
                id="firebaseStorage"
                path="/users/[[user.uid]]/images"
                upload-tasks="{{uploadTasks}}">
        </firebase-storage-multiupload>

        <template is="dom-repeat" items="[[uploadTasks]]">
            <firebase-storage-upload-task
                    id="firebaseUploadTask"
                    task="[[item]]"
                    bytes-transferred="{{item.bytesTransferred}}"
                    total-bytes="{{item.totalBytes}}"
                    state="{{item.state}}"
                    download-url="{{item.downloadUrl}}"
                    metadata="{{item.metadata}}"
                    path="{{item.path}}">
            </firebase-storage-upload-task>
        </template>


        <geo-location watch-pos high-accuracy latitude="{{latitude}}" longitude="{{longitude}}"></geo-location>

        <input id="latitude" value="{{latitude}}" hidden>
        <input id="longitude" value="{{longitude}}" hidden>

        <div style="position: absolute; left: 50%">
            <a href="[[rootPath]]home">
                <img src="../images/manifest/horizontal_logo.png" height="57" width="86">
            </a>
        </div>


        <div class="card">

            <h1 style="font-size:200%">Be Found/ Create Beeqin</h1>

            <vaadin-radio-group id="coreType" value="{{coreType}}" on-value-changed="_identifyCoreBeFoundType">
                <vaadin-radio-button value="Your Profile" id="coreType1">Your Profile</vaadin-radio-button>
                <vaadin-radio-button value="Your Business or Service" id="coreType2">Your Business or Service
                </vaadin-radio-button>
                <vaadin-radio-button value="Classified Ad" id="coreType3">Classified Ad</vaadin-radio-button>
                <vaadin-radio-button value="Group Hangout" id="coreType4">Group Hangout</vaadin-radio-button>
                <vaadin-radio-button value="Custom" id="coreType5">Custom</vaadin-radio-button>
                <!--<vaadin-radio-button value="Garage Sale">Garage Sale</vaadin-radio-button>
                <vaadin-radio-button value="Study Group">Study Group</vaadin-radio-button>-->
            </vaadin-radio-group>

            <div id="coreType1Div" class="hide">
                <hr>
                <vaadin-radio-group id="yourProfileType" value="{{yourProfileType}}"
                                    on-value-changed="_identifyYourProfileType">
                    <vaadin-radio-button value="Personal Profile" id="personalProfile">Personal Profile
                    </vaadin-radio-button>
                    <vaadin-radio-button value="Professional Profile" id="professionalProfile">Professional Profile
                    </vaadin-radio-button>
                </vaadin-radio-group>

                <!--Professional Profile Fields-->
                <div id="personalProfileDiv" class="hide">
                    <vaadin-text-field label="Personal Profile Beeqin"></vaadin-text-field>
                </div>
                <div id="professionalProfileDiv" class="hide">
                    <strong>These fields are here as suggestions for your Professional Profile. Any fields left
                        blank will be omitted on your displayed Beeqin. Only share what you want!</strong>
                    <hr>
                    <vaadin-upload id="vaadinUpload" max-files="1" accept="image/*" max-file-size="4000000"
                            on-files-changed="_onFileUpload">
                        <vaadin-progress-bar></vaadin-progress-bar>
                    </vaadin-upload>
                    <img src="{{item.downloadUrl}}">

                    <vaadin-text-field style="width: 100%" label="Beeqin Display Name"
                                       id="displayName"></vaadin-text-field>
                    <vaadin-text-field style="width: 100%" label="First Name" id="firstName"></vaadin-text-field>
                    <vaadin-text-field style="width: 100%" label="Last Name" id="lastName"></vaadin-text-field>
                    <vaadin-text-field style="width: 100%" label="Phone Number" id="phoneNumber"></vaadin-text-field>
                    <vaadin-text-field style="width: 100%" label="Email Address" id="emailAddress"></vaadin-text-field>
                    <vaadin-radio-group id="messagePermission" value="{{messagePermission}}">
                        <p>Would you like people to be able to message you in app for this Beeqin?</p>
                        <vaadin-radio-button value="Yes">Yes</vaadin-radio-button>
                        <vaadin-radio-button value="No">No</vaadin-radio-button>
                    </vaadin-radio-group>
                    <vaadin-text-area style="width: 100%; min-height: 100px" label="Headline"
                                      id="headline"></vaadin-text-area>
                    <vaadin-text-field style="width: 100%" label="College Attended"
                                       id="collegeAttended"></vaadin-text-field>
                    <vaadin-text-field style="width: 100%" label="High School Attended"
                                       id="highSchoolAttended"></vaadin-text-field>
                    <vaadin-text-area style="width: 100%; min-height: 100px" label="Organizations You're a Member of"
                                       id="organizations"></vaadin-text-area>
                    <vaadin-text-field style="width: 100%" label="Industry" id="industry"></vaadin-text-field>
                    <vaadin-radio-group id="geoLocOrFixed" value="{{geoLocOrFixed}}" on-value-changed="_geoOrFixed">
                        <p>Would you like to use your Geo Location for this Beeqin? Or a fixed address?</p>
                        <vaadin-radio-button value="Geo Location" id="geoLocRadio">Geo Location</vaadin-radio-button>
                        <vaadin-radio-button value="Fixed Address" id="fixedAddressRadio">Fixed Address
                        </vaadin-radio-button>
                    </vaadin-radio-group>
                    <div id="fixedAddressDiv" class="hide">
                        <p>What address?</p>
                        <vaadin-text-field style="width: 100%" label="Street" id="addressStreet"></vaadin-text-field>
                        <vaadin-text-field style="width: 100%" label="City" id="addressCity"></vaadin-text-field>
                        <vaadin-text-field style="width: 100%" label="State" id="addressState"></vaadin-text-field>
                        <vaadin-text-field style="width: 100%" label="Zip Code" id="addressZipCode"></vaadin-text-field>
                    </div>
                    <vaadin-text-area style="width: 100%; min-height: 200px" label="Summary"
                                      id="summary"></vaadin-text-area>
                    <vaadin-text-field style="width: 100%" label="Website or Social Media links"
                                       id="links1"></vaadin-text-field>
                    <vaadin-text-field style="width: 100%" label="" id="links2"></vaadin-text-field>
                    <vaadin-text-field style="width: 100%" label="" id="links3"></vaadin-text-field>
                    <vaadin-radio-group id="linkBeeqins" value="{{linkBeeqins}}">
                        <p>Would you like to link any of your other saved Beeqins to this one?</p>
                        <vaadin-radio-button value="Yes">Yes</vaadin-radio-button>
                        <vaadin-radio-button value="No">No</vaadin-radio-button>
                    </vaadin-radio-group>
                    <br>
                    <vaadin-combo-box
                            style="width: 17em; padding-right: 10px"
                            id="foundDistance"
                            label="How Far to Broadcast?"
                            items="[[distancelist]]"
                            value="{{foundDistance}}">
                    </vaadin-combo-box>
                    <vaadin-combo-box
                            style="width: 17em; padding-bottom: 150px"
                            id="foundTime"
                            label="When do you want to broadcast?"
                            items="[[timelist]]"
                            value="{{foundTime}}">
                    </vaadin-combo-box>
                    <br>
                    <div style="position: relative">
                        <paper-button raised class="custom beeqin" on-tap="_createBeacon">
                            <iron-icon icon="beacon-icons:search"></iron-icon>
                            !Create Beeqin
                        </paper-button>
                    </div>
                </div>
            </div>

            <div id="coreType2Div" class="hide">
                <vaadin-text-field label="Business or Service Name"></vaadin-text-field>
            </div>

            <div id="coreType3Div" class="hide">
                <vaadin-text-field label="Classified Ad"></vaadin-text-field>
            </div>

            <div id="coreType4Div" class="hide">
                <vaadin-text-field label="Group Hangout"></vaadin-text-field>
            </div>

            <div id="coreType5Div" class="hide">
                <vaadin-text-field label="Custom"></vaadin-text-field>
            </div>

            <!--<vaadin-combo-box
                    id="coreType"
                    label="Create Beeqin!  What would you like to be found?"
                    items="[[foundlist]]"
                    value="{{coreType}}"
                    allow-custom-value
                    style="width: 360px">
            </vaadin-combo-box>-->

            <!--<vaadin-combo-box
                    id="found2"
                    label="Unlock more filters"
                    items=""
                    value="{{found2}}"
                    disabled>
            </vaadin-combo-box>


            <vaadin-combo-box
                    id="found3"
                    label="Unlock more filters"
                    items=""
                    value="{{found3}}"
                    disabled>
            </vaadin-combo-box>-->

            <!--<paper-input
                    id="beFoundDescription"
                    label="Beeqin Description"
                    value="{{beFoundDescription}}"
                    char-counter maxlength="140">
            </paper-input>-->

            <!--<paper-button toggles raised class="custom beeqin">
            <iron-icon icon="beacon-icons:save"></iron-icon>
            !Save Beeqin to Favorites
            </paper-button>-->
        </div>


        <paper-dialog opened$="{{beaconCreated}}">
            <h2>Beacon Created!</h2>
        </paper-dialog>


    </template>

    <script>
        class BeaconBeFound extends Polymer.Element {
            static get is() {
                return 'beacon-befound';
            }

            static get properties() {
                return {
                    /*foundlist: {
                        type: Array,
                        value: ['Your Profile', 'Your Business or Service', 'Classified Ad', 'Group Hangout', 'Custom', 'Garage Sale', 'Study Group'],
                    },*/
                    distancelist: {
                        type: Array,
                        value: ['Out 1 Mile', 'Out 5 Miles', 'Out 10 Miles', 'Out 25 Miles'],
                    },
                    timelist: {
                        type: Array,
                        value: ['Always On', 'Custom'],
                    },
                    /*found1: {
                        type: Object,
                    },
                    found2: {
                        type: Object,
                    },
                    found3: {
                        type: Object,
                    },*/
                    /*beFoundDescription: {
                        type: String,
                    },*/
                    foundDistance: {
                        type: Object,
                    },
                    foundTime: {
                        type: Object,
                    },
                    latitude: {
                        type: Number,
                    },
                    longitude: {
                        type: Number,
                    },
                    beaconCreated: {
                        type: Boolean,
                        notify: true,
                        value: false,
                    },
                    coreType: {
                        type: Object,
                        notify: true,
                    },
                    coreType1: {
                        type: Object,
                        notify: true,
                    },
                    coreType2: {
                        type: Object,
                        notify: true,
                    },
                    coreType3: {
                        type: Object,
                        notify: true,
                    },
                    coreType4: {
                        type: Object,
                        notify: true,
                    },
                    coreType5: {
                        type: Object,
                        notify: true,
                    },
                    coreType1Div: {
                        type: Object,
                    },
                    coreType2Div: {
                        type: Object,
                    },
                    coreType3Div: {
                        type: Object,
                    },
                    coreType4Div: {
                        type: Object,
                    },
                    coreType5Div: {
                        type: Object,
                    },
                    personalProfile: {
                        type: Object,
                        notify: true,
                    },
                    professionalProfile: {
                        type: Object,
                        notify: true,
                    },
                    personalProfileDiv: {
                        type: Object,
                    },
                    professionalProfileDiv: {
                        type: Object,
                    },
                    vaadinUpload: {
                        type: Array,
                        notify: true,
                        value: [],
                    },
                    user: {
                        type: Object,
                        notify: true,
                    },
                    fixedAddressRadio: {
                        type: Object,
                        notify: true,
                    },
                    fixedAddressDiv: {
                        type: Object,
                    },
                    geoLocRadio: {
                        type: Object,
                        notify: true,
                    },
                    useGeoLoc: {
                        type: Boolean,
                        notify: true,
                        value: true,
                    },
                };
            }

            //identify which core type of Beeqin was selected in radio button
            _identifyCoreBeFoundType() {
                if (this.$.coreType1.checked === false) {
                    this.$.coreType1Div.style.display = 'none';
                }
                if (this.$.coreType2.checked === false) {
                    this.$.coreType2Div.style.display = 'none';
                }
                if (this.$.coreType3.checked === false) {
                    this.$.coreType3Div.style.display = 'none';
                }
                if (this.$.coreType4.checked === false) {
                    this.$.coreType4Div.style.display = 'none';
                }
                if (this.$.coreType5.checked === false) {
                    this.$.coreType5Div.style.display = 'none';
                }
                if (this.$.coreType1.checked === true) {
                    console.log("Your Profile");
                    this.$.coreType1Div.style.display = 'block';

                } else if (this.$.coreType2.checked === true) {
                    console.log("Your Business or Service");
                    this.$.coreType2Div.style.display = 'block';

                } else if (this.$.coreType3.checked === true) {
                    console.log("Classified Ad");
                    this.$.coreType3Div.style.display = 'block';

                } else if (this.$.coreType4.checked === true) {
                    console.log("Group Hangout");
                    this.$.coreType4Div.style.display = 'block';

                } else {
                    console.log("Custom");
                    this.$.coreType5Div.style.display = 'block';
                }
            }

            //identify which profile type was selected in radio buttons
            _identifyYourProfileType() {
                if (this.$.personalProfile.checked === false) {
                    this.$.personalProfileDiv.style.display = 'none';
                }
                if (this.$.professionalProfile.checked === false) {
                    this.$.professionalProfileDiv.style.display = 'none';
                }
                if (this.$.personalProfile.checked === true) {
                    console.log("Personal Profile");
                    this.$.personalProfileDiv.style.display = 'block';
                }
                if (this.$.professionalProfile.checked === true) {
                    console.log("Professional Profile");
                    this.$.professionalProfileDiv.style.display = 'block';
                }
            }

            _geoOrFixed() {
                if (this.$.fixedAddressRadio.checked === false) {
                    this.$.fixedAddressDiv.style.display = 'none';
                }
                if (this.$.geoLocRadio.checked === false) {
                    this.useGeoLoc = false;
                }
                if (this.$.fixedAddressRadio.checked === true) {
                    console.log("Use Fixed Address");
                    this.$.fixedAddressDiv.style.display = 'block';
                }
                if (this.$.geoLocRadio.checked === true) {
                    console.log("Use Geographical Location");
                    this.useGeoLoc = true;
                }
            }


            //fill upload image
            _onFileUpload(e) {
                this.$.firebaseStorage.upload(this.$.vaadinUpload.files);
                console.log(this.$.vaadinUpload.files);
            }

            //create beeqin and push to firebase.  need to adjust to a preview view first
            _createBeacon() {
                this.$.befound.ref.push({
                    user: this.user.uid,
                    coreType: this.$.coreType.value,
                    found2: this.$.found2.value,
                    found3: this.$.found3.value,
                    beFoundDescription: this.$.beFoundDescription.value,
                    foundDistance: this.$.foundDistance.value,
                    foundTime: this.$.foundTime.value,
                    latitude: this.$.latitude.value,
                    longitude: this.$.longitude.value
                });
                this.$.coreType.value = null;
                this.$.found2.value = null;
                this.$.found3.value = null;
                this.$.beFoundDescription.value = null;
                this.$.foundDistance.value = null;
                this.$.foundTime.value = null;
                this.beaconCreated = true;
            }

        }

        window.customElements.define(BeaconBeFound.is, BeaconBeFound);
    </script>
</dom-module>
